<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Move @ UP</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
        integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
        crossorigin=""/>
        <!-- Make sure you put this AFTER Leaflet's CSS -->
        <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
        integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
        crossorigin=""></script>
        <!-- Adding the CND for JQuery -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    </head>
<body>
    <h1 style="font-family:verdana; font-size:36px; padding: 0px">Move@UP</h1>    
    <h2 style="font-family:arial; font-size:15px; padding: 0px">Powered by: GIS in Motion</h2>
    <div id="map" style="width: 900px; height: 600px;"></div>
    <script>
       
       var map = L.map('map').setView([-25.754544, 28.231482], 16);
       L.tileLayer('https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; <a href="https://carto.com/attributions">CARTO</a>',
      subdomains: 'abcd',
      maxZoom: 19
    }).addTo(map)

    //add basemap with general campus infrastructure   
    var basemap =  L.tileLayer.wms('http://localhost:8080/geoserver/gmt320_moveatup/wms?' , { layers: 'Gates,Paths,Roads', format: 'image/png',transparent: true}).addTo(map)

    //define layer group for search function
    //WFS root url
    var owsrootUrl = "http://localhost:8080/geoserver/gmt320_moveatup/ows?";

    //define buildings
    //define buildings parameters
    var defaultBuildings = {
		service : 'WFS',
        version : '2.0.0',
        request : 'GetFeature',
        typeName : 'gmt320_moveatup:Parking',
        outputFormat : 'text/javascript',
        format_options : 'callback:getJsonBuildings',
        SrsName : 'EPSG:4326'
    };
        var parameters_buildings = L.Util.extend(defaultBuildings);
        var URL_buildings = owsrootUrl + L.Util.getParamString(parameters_buildings);

        //create empty layer for buildings
        var buildingLayer = null;
        let buildingLayerGroup = new L.LayerGroup().addTo(map);

        // ajax request for buildings
        var ajax_buildings = $.ajax({
        url: URL_buildings,
        dataType: "jsonp",
        jsonpCallback: "getJsonBuildings",

        success: function (response) {
            buildingLayer = L.geoJson(response, {
                style: function (feature) {
                    return
                },
                
        onEachFeature: function (feature, layer){
            popupOptions = {maxWidth: 200};
            var name = 'Name: ' + feature.properties.name;
            layer.bindPopup(name+ '<br>', popupOptions);
        }
    }).addTo(buildingLayerGroup);
        }
});

    map.addLayer(buildingLayer);

    /*const popupInfo =
    `<b>Name: </b>${feature.properties.name} <br>`; */

    </script>